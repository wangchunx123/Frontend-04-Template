# 浏览器的工作原理

[图解浏览器的基本工作原理](https://zhuanlan.zhihu.com/p/47407398)

> 浏览器由多个进程组成，每个进程都有自己的核心职责，他们互相配合完成浏览器的整体功能。每个进程又包含多个线程，一个进程内的多个线程也会协同工作，配合完成所有进程的职责。

### 进程(Process) 和线程(Thread)
```
  进程就像是一个有边界的生产厂间，而线程就像是厂间内的一个个员工，可以自己做自己的事情，也可以相互配合做同一件事情。

  当我们启动一个应用，计算机会创建一个进程，操作系统会为进程分配一部分内存，应用的所有状态都会保存在这块内存中，应用也许还会创建多个线程来辅助工作，这些线程可以共享这部分内存中的数据。如果应用关闭，进程会被终结，操作系统会释放相关内存

  一个进程还可以要求操作系统生成另一个进程来执行不同的任务，系统会为新的进程分配独立的内存，两个进程之间可以使用 IPC （Inter Process Communication）进行通信。很多应用都会采用这样的设计，如果一个工作进程反应迟钝，重启这个进程不会影响应用其它进程的工作。
```

> 如果实现一个浏览器可以采取不同的架构：可以是单进程多线程的应用、也可以是使用IPC通信的多进程的应用

![Image text](https://pic4.zhimg.com/80/v2-f04b3c3b86e76c1f63679d6a93191251_720w.jpg)
> 以Chrome为例。Chrome采取的是多进程架构。其顶层存在一个Browser process 用以协调浏览器的其他进程。

![Image text](https://picb.zhimg.com/80/v2-6b4e841c652a7a15554e98abce726222_720w.jpg)

### Chrome 的主要进程及其职责如下：
- Browser Process：
1. 负责包括地址栏，书签栏，前进后退按钮等部分的工作；
2. 负责处理浏览器的一些不可见的底层操作，比如网络请求和文件访问；
- Renderer Process：
1. 负责一个 tab 内关于网页呈现的所有事情
- Plugin Process：
1. 负责控制一个网页用到的所有插件，如 flash
- GPU Process
1. 负责处理 GPU 相关的任务

![Image text](https://pic1.zhimg.com/80/v2-de9e1fee7f8cd6a7572c280e36e7fb7a_720w.jpg)

### Chrome 多进程架构的优缺点
### 优点
1. 某一渲染进程出问题不会影响其他进程
2. 更为安全，在系统层面上限定了不同进程的权限
### 缺点
1. 由于不同进程间的内存不共享，不同进程的内存常常需要包含相同的内容。

为了节省内存，Chrome 限制了最多的进程数，最大进程数量由设备的内存和 CPU 能力决定，当达到这一限制时，新打开的 Tab 会共用之前同一个站点的渲染进程。

Chrome 把浏览器不同程序的功能看做服务，这些服务可以方便的分割为不同的进程或者合并为一个进程。以 Broswer Process 为例，如果 Chrome 运行在强大的硬件上，它会分割不同的服务到不同的进程，这样 Chrome 整体的运行会更加稳定，但是如果 Chrome 运行在资源贫瘠的设备上，这些服务又会合并到同一个进程中运行，这样可以节省内存。